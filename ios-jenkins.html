<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/uploads/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/uploads/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="实践,持续集成,Jenkins," />










<meta name="description" content="Jenkins 概述Jenkins是什么？&amp;emsp;&amp;emsp;Jenkins 是一款流行的开源持续集成（Continuous Integration，简称CI）工具，广泛用于项目开发，具有自动化构建、测试和部署等功能。通常与版本管理工具(SCM)、构建工具结合使用。常用的版本控制工具有SVN、GIT，构建工具有Maven、Ant、Gradle，当然也可以通过插件的方式安装Xcode构建工具。&amp;">
<meta name="keywords" content="实践,持续集成,Jenkins">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS 使用Jenkins持续集成">
<meta property="og:url" content="http://cloverkim.com/ios-jenkins.html">
<meta property="og:site_name" content="幸运四叶草">
<meta property="og:description" content="Jenkins 概述Jenkins是什么？&amp;emsp;&amp;emsp;Jenkins 是一款流行的开源持续集成（Continuous Integration，简称CI）工具，广泛用于项目开发，具有自动化构建、测试和部署等功能。通常与版本管理工具(SCM)、构建工具结合使用。常用的版本控制工具有SVN、GIT，构建工具有Maven、Ant、Gradle，当然也可以通过插件的方式安装Xcode构建工具。&amp;">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://pic.cloverkim.com/Jenkins思维导图.png">
<meta property="og:image" content="http://pic.cloverkim.com/unlockjenkins.png">
<meta property="og:image" content="http://pic.cloverkim.com/customize-jenkins.png">
<meta property="og:image" content="http://pic.cloverkim.com/plug-install.png">
<meta property="og:image" content="http://pic.cloverkim.com/create-admin.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200116155027.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200116155447.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200116162055.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200116162936.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200116164456.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200116191327.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200116194838.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200116201036.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117094515.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117100456.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117103025.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117105500.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117105704.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117110002.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117175423.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117180315.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117181507.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117111050.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117110536.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117112049.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117114521.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117113608.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117193736.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117194347.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117195942.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117200215.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117203108.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117203128.png">
<meta property="og:image" content="http://pic.cloverkim.com/20200117203554.png">
<meta property="og:updated_time" content="2022-10-26T11:24:45.527Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS 使用Jenkins持续集成">
<meta name="twitter:description" content="Jenkins 概述Jenkins是什么？&amp;emsp;&amp;emsp;Jenkins 是一款流行的开源持续集成（Continuous Integration，简称CI）工具，广泛用于项目开发，具有自动化构建、测试和部署等功能。通常与版本管理工具(SCM)、构建工具结合使用。常用的版本控制工具有SVN、GIT，构建工具有Maven、Ant、Gradle，当然也可以通过插件的方式安装Xcode构建工具。&amp;">
<meta name="twitter:image" content="http://pic.cloverkim.com/Jenkins思维导图.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://cloverkim.com/ios-jenkins.html"/>





  <title>iOS 使用Jenkins持续集成 | 幸运四叶草</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">幸运四叶草</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">相思形色露，欲掩不从心。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav" id="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-标签">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-分类">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-归档">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://cloverkim.com/ios-jenkins.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kim逸云">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="幸运四叶草">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">iOS 使用Jenkins持续集成</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-10-26T19:24:45+08:00">
                2022-10-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/开发工具/" itemprop="url" rel="index">
                    <span itemprop="name">开发工具</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/ios-jenkins.html" class="leancloud_visitors" data-flag-title="iOS 使用Jenkins持续集成">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  20
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Jenkins-概述"><a href="#Jenkins-概述" class="headerlink" title="Jenkins 概述"></a>Jenkins 概述</h1><h2 id="Jenkins是什么？"><a href="#Jenkins是什么？" class="headerlink" title="Jenkins是什么？"></a>Jenkins是什么？</h2><p>&emsp;&emsp;<a href="https://jenkins.io/zh/" target="_blank" rel="noopener">Jenkins</a> 是一款流行的开源持续集成（Continuous Integration，简称CI）工具，广泛用于项目开发，具有自动化构建、测试和部署等功能。通常与版本管理工具(SCM)、构建工具结合使用。常用的版本控制工具有SVN、GIT，构建工具有Maven、Ant、Gradle，当然也可以通过插件的方式安装Xcode构建工具。<br>&emsp;&emsp;CI是一种开发实践。实践应该包含3个基本模块，一个可以自动构建的过程，自动编译代码，可以自动分发，部署和测试。一个代码仓库，SVN或者Git。最后一个是一个持续集成的服务器。通过持续集成，可以让我们通过自动化等手段高频率地去获取产品反馈并响应反馈的过程。<a id="more"></a></p>
<p><img src="http://pic.cloverkim.com/Jenkins思维导图.png" alt="" title="Jenkins思维导图"></p>
<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><ul>
<li><p>缩减开发周期，快速迭代版本<br>&emsp;&emsp;每个版本开始都会估算好开发周期，但是总会因为各种事情而延期。这其中包括了一些客观因素。由于产品线增多，迭代速度越来越快，给测试带来的压力也越来越大。如果测试都在开发完全开发完成之后再来测试，那就会影响很长一段时间。这时候由于集成晚就会严重拖慢项目节奏。如果能尽早的持续集成，尽快进入上图的12步骤的迭代环中，就可以尽早的暴露出问题，提早解决，尽量在规定时间内完成任务。</p>
</li>
<li><p>自动化流水线操作带来的高效<br>&emsp;&emsp;其实打包对于开发人员来说是一件很耗时，而且没有很大技术含量的工作。如果开发人员一多，相互改的代码冲突的几率就越大，加上没有产线管理机制，代码仓库的代码质量很难保证。团队里面会花一些时间来解决冲突，解决完了冲突还需要自己手动打包。这个时候如果证书又不对，又要耽误好长时间。这些时间其实可以用持续集成来节约起来的。一天两天看着不多，但是按照年的单位来计算，可以节约很多时间！</p>
</li>
<li><p>随时可部署<br>&emsp;&emsp;有了持续集成以后，我们可以以天为单位来打包，这种高频率的集成带来的最大的优点就是可以随时部署上线。这样就不会导致快要上线，到处是漏洞，到处是bug，手忙脚乱弄完以后还不能部署，严重影响上线时间。</p>
</li>
<li><p>极大程度避免低级错误</p>
</li>
</ul>
<h1 id="Jenkins-安装"><a href="#Jenkins-安装" class="headerlink" title="Jenkins 安装"></a>Jenkins 安装</h1><p>&emsp;&emsp;在安装Jenkins之前，要保证Mac已经安装好了Java环境，因为Jenkins的运行需要依赖于Java环境。</p>
<h2 id="pkg镜像安装"><a href="#pkg镜像安装" class="headerlink" title="pkg镜像安装"></a>pkg镜像安装</h2><p>&emsp;&emsp;pkg镜像包<a href="https://jenkins.io/zh/download/" target="_blank" rel="noopener">下载地址</a>，下载完安装，直接安装，一路下一步即可，比较简单。</p>
<h2 id="Homebrew"><a href="#Homebrew" class="headerlink" title="Homebrew"></a>Homebrew</h2><p>&emsp;&emsp;如果有不了解Homebrew的同学，可以先了解一下（<a href="https://brew.sh/index_zh-cn" target="_blank" rel="noopener">Homebrew官网</a>）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 安装命令</span><br><span class="line">$ brew install jenkins</span><br><span class="line">/// 启动Jenkins</span><br><span class="line">$ jenkins</span><br></pre></td></tr></table></figure></p>
<h2 id="war包方式安装（推荐）"><a href="#war包方式安装（推荐）" class="headerlink" title="war包方式安装（推荐）"></a>war包方式安装（推荐）</h2><p>&emsp;&emsp;推荐使用war包的方式进行安装，可以指定端口号，方便端口号的管理使用。<a href="http://updates.jenkins-ci.org/download/war/" target="_blank" rel="noopener">war包下载地址</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">使用命令</span><br><span class="line">$ java -jar /Documents/jenkins.war –httpPort=8080</span><br></pre></td></tr></table></figure></p>
<h1 id="Jenkins配置"><a href="#Jenkins配置" class="headerlink" title="Jenkins配置"></a>Jenkins配置</h1><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><ul>
<li><p>Unlock Jenkins<br>&emsp;&emsp;首次启动Jenkins，会要求对Jenkins进行解锁操作，在下图中显示的路径<code>Users/Shared/Jenkins/Home/secrets/initialAdminPassword</code>中存放着解锁需要的密码。我们可以直接在终端中使用<code>cat</code>命令就可获取到密码，直接粘贴，continue。<br>  <img src="http://pic.cloverkim.com/unlockjenkins.png" alt="" title="Unlock Jenkins"></p>
</li>
<li><p>Customize Jenkins<br>&emsp;&emsp;接下来是对Jenkins进行定制，有安装推荐的插件以及选择插件进行安装，这里选择安装的推荐插件即可。<br><img src="http://pic.cloverkim.com/customize-jenkins.png" alt="" title="Customize Jenkins"><br><img src="http://pic.cloverkim.com/plug-install.png" alt="" title="插件安装安装"></p>
</li>
<li><p>Create First Admin User<br>&emsp;&emsp;最后一步为，创建一个管理员用户。根据自己的信息新建一个用户即可。<br><img src="http://pic.cloverkim.com/create-admin.png" alt="" title="新建Admin用户"></p>
</li>
</ul>
<h2 id="插件安装"><a href="#插件安装" class="headerlink" title="插件安装"></a>插件安装</h2><h3 id="常用插件介绍"><a href="#常用插件介绍" class="headerlink" title="常用插件介绍"></a>常用插件介绍</h3><ul>
<li>Xcode integration（该插件为构建者提供了构建xcode项目，调用agvtool和打包.ipa文件的工具）</li>
<li>GIT plugin</li>
<li>GitLab Plugin</li>
<li>GitLab Hook Plugin</li>
<li>Keychains and Provisioning Profiles Management（证书管理插件）</li>
<li>Branch API Plugin（多分支管理插件）</li>
<li>Build Name and Description Setter（构建名称和构建完成描述设置插件）</li>
<li>Build With Parameters（多参数构建设置）</li>
<li>description setter plugin（构建完成日志描述）</li>
<li>Dingding[钉钉] Plugin（钉钉通知推送插件）</li>
<li>fir-plugin（上传到fir.im必备插件）</li>
<li>Localization: Chinese (Simplified)（中文本地化插件）</li>
<li>Project Description Setter</li>
<li>Role-based Authorization Strategy（用户权限管理）</li>
<li>Version Number Plug-In（允许构件时修改项目版本号）</li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li><p>搜索安装<br>&emsp;&emsp;从Manage Jenkins - Manage Plugins，进入插件管理页面，在可选插件tab以及右上角的过滤中，搜索需要安装的插件，勾选对应的插件，然后直接点击下方的安装，等待安装完毕以及Jenkins重启完毕即可。<br><img src="http://pic.cloverkim.com/20200116155027.png" alt="" title="插件安装"></p>
</li>
<li><p>本地上传<br>&emsp;&emsp;依然是在插件管理页面， 在高级tab页中，在页面下方的上传插件进行上传下载的.hpi插件文件。剩下步骤同搜索安装。<br><img src="http://pic.cloverkim.com/20200116155447.png" alt="" title="本地上传"></p>
</li>
</ul>
<p>&emsp;&emsp;以下相关教程，均在以上插件已安装完成的条件下进行。</p>
<h2 id="keychain和证书上传配置"><a href="#keychain和证书上传配置" class="headerlink" title="keychain和证书上传配置"></a>keychain和证书上传配置</h2><p>&emsp;&emsp;要出现管理证书入口，要先安装证书管理插件（Keychains and Provisioning Profiles Management），然后从Manage Jenkins - Keychains and Provisioning Profiles Management入口中，进入证书管理页面，先配置Keychains。对于login.keychain文件，在/Users/管理员用户名/Library/keychains/ 目录下，但是由于系统的关系，当前的keychains名称为login.keychain-db，这里我们需要复制一份到另外一个目录下，将其修改为login.keychain即可继续上传。证书的代码签名身份，在“钥匙串”App的“我的证书”里面能获取到。<br><img src="http://pic.cloverkim.com/20200116162055.png" alt="" title="添加keychains"><br>&emsp;&emsp;接下来上传所需要的证书。在/Users/管理员用户名/Library/MobileDevice/Provisioning Profiles目录下，找到打包需要的证书，这里我只用到了ADHoc的证书，并将其复制到一个指定的目录中，这里我复制到了桌面的MobileDevice目录下。证书的上传同上一步keychain的上传。<br><img src="http://pic.cloverkim.com/20200116162936.png" alt="" title="上传证书"></p>
<p>&emsp;&emsp;如果是从开发者官网下载的证书，这里分享一个用终端的方式，获取证书对应的UUID，<a href="https://my.oschina.net/ioslighter/blog/494342" target="_blank" rel="noopener">命令行获取mobileprovision文件的UUID</a><br><img src="http://pic.cloverkim.com/20200116164456.png" alt="" title="获取证书UUID"></p>
<h1 id="创建项目、配置"><a href="#创建项目、配置" class="headerlink" title="创建项目、配置"></a>创建项目、配置</h1><h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2><p>&emsp;&emsp;从首页的左侧菜单新建item中，进入项目新建页面，创建步骤，如下图所示。<br><img src="http://pic.cloverkim.com/20200116191327.png" alt="" title="创建步骤"></p>
<h2 id="General配置"><a href="#General配置" class="headerlink" title="General配置"></a>General配置</h2><p><img src="http://pic.cloverkim.com/20200116194838.png" alt="" title="General"><br>&emsp;&emsp;如上图所示，下列我们针对常用3项进行详细说明，分别为项目描述、抛弃旧的构建任务以及多参数构建配置。</p>
<ol>
<li><p>描述 - 填写项目的具体描述</p>
</li>
<li><p>抛弃旧的构建任务<br> &emsp;&emsp;分别有以下丢弃策略，这里我们一般用前面2种策略，保持构建的天数或者构建的最大个数。</p>
<ul>
<li>保持构建的天数</li>
<li>保持构建的最大个数</li>
<li>发布包保留天数</li>
<li>发布包最大保留#个构建</li>
</ul>
</li>
<li><p>This project is parameterized（多参数构建配置）<br>&emsp;&emsp;针对多参数构建，这里只对以下常用的配置进行说明，配置完成的结果如下图所示：</p>
<ul>
<li>Boolean Parameter（布尔值参数类型，比如用于是否为Jenkins打包，一些参数控制等）</li>
<li>Choice Parameter（选择参数，比如用户打包环境的选择）</li>
<li>Git Parameter（Git参数，用于Branch/Tag/Revision/Pull Request选择构建）</li>
<li>String Parameter（字符串类型参数，比如用于版本号以及build版本号的使用等）<br><img src="http://pic.cloverkim.com/20200116201036.png" alt="" title="多参数配置示例"><br><img src="http://pic.cloverkim.com/20200117094515.png" alt="" title="使用示例"></li>
</ul>
</li>
</ol>
<h2 id="源代码管理"><a href="#源代码管理" class="headerlink" title="源代码管理"></a>源代码管理</h2><p>&emsp;&emsp;因为基本是是用Git来管理代码，因此这里只介绍Git的方式。一般公司会搭建属于自己的gitlab仓库，这里的仓库URL就要到自己公司的代码仓库进行查看，凭据的用户名和密码就是自己登陆gitlab的用户名和密码。这里特别说明下，指定分支，不要用默认以及写死，这里要用到上面配置的多参数管理中的Git Parameter，用<code>$</code>来引用定义的name，比如<code>$BRANCH</code>，在构建时，选择对应的分支就会拉取对应的分支代码。<br><img src="http://pic.cloverkim.com/20200117100456.png" alt="" title="源代码管理"></p>
<h2 id="构建触发器"><a href="#构建触发器" class="headerlink" title="构建触发器"></a>构建触发器</h2><p>&emsp;&emsp;构建触发器主要是设置自动化测试的配置，触发器可自定义的地方很多，可以根据自己实际的项目进行配置，这里不做多说明和研究了。主要讲下下面的定时构建和轮询SCM。</p>
<ul>
<li>定时构建：不管是SVN或者Git中代码是否有提交，均执行定时化的构建任务。</li>
<li>轮询SCM：只要SVN或者Git中代码有更新，则执行构建任务，日程表的填写内容有个参数，从左到右的参数含义如下：<ul>
<li>分钟minute，取值0~59</li>
<li>小时hour，取值0~23</li>
<li>天day，取值1~31</li>
<li>月month，取值1~12</li>
<li>星期week，取值0~7（0和7都是表示星期日）</li>
</ul>
</li>
</ul>
<p>&emsp;&emsp;以上5个参数可选择性设定，不写死的参数用<code>*</code>代替参数之间用空格隔开，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;0 21 * * *&quot;表示每晚21点0分自动化构建一次</span><br><span class="line">&quot;0 * * * *&quot;表示每个小时的第0分钟执行一次构建</span><br><span class="line">&quot;H/5 * * * *&quot;每隔5分钟构建一次</span><br><span class="line">&quot;H H/2 * * *&quot;每两小时构建一次</span><br><span class="line">&quot;H H 30 * *&quot;每月30号构建一次</span><br><span class="line">&quot;H(0-29)/10 * * * *&quot;每个小时的前半个小时内的每10分钟</span><br><span class="line">&quot;0 8-17/2 * * 1-5&quot;周一到周五，8点~17点，两小时构建一次</span><br><span class="line">&quot;H H 1,15 1-11 *&quot;每月1号、15号各构建一次，除12月等</span><br></pre></td></tr></table></figure></p>
<p><img src="http://pic.cloverkim.com/20200117103025.png" alt="" title="构建触发器"></p>
<h2 id="构建环境"><a href="#构建环境" class="headerlink" title="构建环境"></a>构建环境</h2><p>&emsp;&emsp;在构建环境中，有很多配置项。但这里只针对以下几项常用项进行说明<code>Keychains and Code Signing Identities</code>、<code>Mobile Provisioning Profiles</code>、<code>Set jenkins user build variables</code>。</p>
<ul>
<li><p>Keychains and Code Signing Identities：keychains和签名身份，这里用的是之前在证书管理页面中进行配置的，这我们选择项目所对应的keychains和签名身份即可，示例是下图所示：<br><img src="http://pic.cloverkim.com/20200117105500.png" alt=""></p>
</li>
<li><p>Mobile Provisioning Profiles：证书文件，这里用到的也是在证书管理页面上传配置的，这里只需要选择对应的证书名称，其余项不需要手动配置，示例如下图所示：<br><img src="http://pic.cloverkim.com/20200117105704.png" alt=""></p>
</li>
<li><p>Set jenkins user build variables：设置jenkins用户构建变量，这个选项是需要安装“user build vars plugin”插件的，该选项的说明如下：<br><img src="http://pic.cloverkim.com/20200117110002.png" alt="" title="Set jenkins user build variables"></p>
</li>
</ul>
<h2 id="构建步骤"><a href="#构建步骤" class="headerlink" title="构建步骤"></a>构建步骤</h2><h3 id="使用脚本构建"><a href="#使用脚本构建" class="headerlink" title="使用脚本构建"></a>使用脚本构建</h3><h4 id="自动化打包命令xcodebuild-xcrun介绍"><a href="#自动化打包命令xcodebuild-xcrun介绍" class="headerlink" title="自动化打包命令xcodebuild + xcrun介绍"></a>自动化打包命令xcodebuild + xcrun介绍</h4><p>&emsp;&emsp;Xcode为开发者提供了一套构建打包的命令，为xcodebuild何xcrun命令。xcodebuild把指定的项目打包成.app文件，xcrun将制定的.app文件转换成对应的.ipa文件。</p>
<ul>
<li>xcodebuild - 相关文档如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">NAME</span><br><span class="line">xcodebuild – build Xcode projects and workspaces</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">1. xcodebuild [-project name.xcodeproj] [[-target targetname] … | -alltargets] [-configuration configurationname] [-sdk [sdkfullpath | sdkname]] [action …] [buildsetting=value …] [-userdefault=value …]</span><br><span class="line"></span><br><span class="line">2. xcodebuild [-project name.xcodeproj] -scheme schemename [[-destination destinationspecifier] …] [-destination-timeout value] [-configuration configurationname] [-sdk [sdkfullpath | sdkname]] [action …] [buildsetting=value …] [-userdefault=value …]</span><br><span class="line"></span><br><span class="line">3. xcodebuild -workspace name.xcworkspace -scheme schemename [[-destination destinationspecifier] …] [-destination-timeout value] [-configuration configurationname] [-sdk [sdkfullpath | sdkname]] [action …] [buildsetting=value …] [-userdefault=value …]</span><br><span class="line"></span><br><span class="line">4. xcodebuild -version [-sdk [sdkfullpath | sdkname]] [infoitem]</span><br><span class="line"></span><br><span class="line">5. xcodebuild -showsdks</span><br><span class="line"></span><br><span class="line">6. xcodebuild -showBuildSettings [-project name.xcodeproj | [-workspace name.xcworkspace -scheme schemename]]</span><br><span class="line"></span><br><span class="line">7. xcodebuild -list [-project name.xcodeproj | -workspace name.xcworkspace]</span><br><span class="line"></span><br><span class="line">8. xcodebuild -exportArchive -archivePath xcarchivepath -exportPath destinationpath -exportOptionsPlist path</span><br><span class="line"></span><br><span class="line">9. xcodebuild -exportLocalizations -project name.xcodeproj -localizationPath path [[-exportLanguage language] …]</span><br><span class="line"></span><br><span class="line">10. xcodebuild -importLocalizations -project name.xcodeproj -localizationPath path</span><br></pre></td></tr></table></figure>
<p>上面所罗列的10个命令中，最主要的是前3个，接下来说明一下参数：</p>
<ol>
<li><code>-project -workspace</code>：这两个对应的为项目的名字，如果有多个工程，在没有指定的情况下，则默认为第一个工程。</li>
<li><code>-target</code>：打包对应的targets，如果没有指定，则默认为第一个。</li>
<li><code>-configuration</code>：如果没有修改这个配置，默认为Debug和Release两种方式，没有指定则默认为Release方式。</li>
<li><code>-buildsetting=value ...</code>：使用此命令修改工程的配置。</li>
<li><code>-scheme</code>：指定打包的scheme。</li>
</ol>
<ul>
<li>xcrun<br>&emsp;&emsp;使用参数不多，使用方法也很简单，xcrun -sdk iphoneos -v PackageApplication + 上述一些参数。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">PackageApplication [-s signature] application [-o output_directory] [-verbose] [-plugin plugin] || -man || -help</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line"></span><br><span class="line">[-s signature]: certificate name to resign application before packaging</span><br><span class="line">[-o output_directory]: specify output filename</span><br><span class="line">[-plugin plugin]: specify an optional plugin</span><br><span class="line">-help: brief help message</span><br><span class="line">-man: full documentation</span><br><span class="line">-v[erbose]: provide details during operation</span><br></pre></td></tr></table></figure>
<ul>
<li>完整的构建脚本示例</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">## !/bin/sh</span><br><span class="line">## 项目名</span><br><span class="line">TARGET_NAME=Your target name</span><br><span class="line">## Scheme名</span><br><span class="line">SCHEME=Your scheme name</span><br><span class="line">##=======================</span><br><span class="line">## 编译类型</span><br><span class="line">BUILD_TYPE=$&#123;BUILD_TYPE&#125;</span><br><span class="line">## 当前目录</span><br><span class="line">SORCEPATH=$&#123;WORKSPACE&#125;</span><br><span class="line">## workspace名</span><br><span class="line">SPACE=$&#123;WORKSPACE&#125;/$&#123;TARGET_NAME&#125;.xcodeproj</span><br><span class="line">##xcarchive文件的存放路径</span><br><span class="line">ARCHIVEPATH=$SORCEPATH/build/$SCHEME.xcarchive</span><br><span class="line">## ipa文件的存放路径</span><br><span class="line">EXPORTPATH=$SORCEPATH/build/$SCHEME</span><br><span class="line">## ExportOptions.plist文件的存放路径，该文件要存放在这个路径下内容如下</span><br><span class="line">EXPORTOPTIONSPLIST=$SORCEPATH/build/ExportOptions.plist</span><br><span class="line">## 导出后的ipa路径</span><br><span class="line">EXPORTPATHIPA=$SORCEPATH/build/$SCHEME/$SCHEME.ipa</span><br><span class="line"></span><br><span class="line">echo -e &quot;============First Build Clean============&quot;</span><br><span class="line">## 清理缓存</span><br><span class="line">## 如果工程使用的是cocoapods，则&apos;-project %s.xcodeproj&apos;替换为&apos;-workspace %s.xcworkspace&apos;</span><br><span class="line">xcodebuild clean -project $SPACE -scheme $&#123;SCHEME&#125; -configuration $&#123;BUILD_TYPE&#125;</span><br><span class="line">echo -e &quot;============Build Clean============&quot;</span><br><span class="line">## 输出关键信息</span><br><span class="line">echo -e &quot;  TARGET_NAME    : $&#123;TARGET_NAME&#125;&quot;</span><br><span class="line">echo -e &quot;  BUILD_TYPE    : $&#123;BUILD_TYPE&#125;&quot;</span><br><span class="line">echo -e &quot;  SORCEPATH    : $&#123;SORCEPATH&#125;&quot;</span><br><span class="line">echo -e &quot;  ARCHIVEPATH    : $&#123;ARCHIVEPATH&#125;&quot;</span><br><span class="line">echo -e &quot;  EXPORTPATH    : $&#123;EXPORTPATH&#125;&quot;</span><br><span class="line">echo -e &quot;  EXPORTOPTIONSPLIST    : $&#123;EXPORTOPTIONSPLIST&#125;&quot;</span><br><span class="line">echo -e &quot;============Build Archive============&quot;</span><br><span class="line"></span><br><span class="line">## 导出archive包</span><br><span class="line">xcodebuild archive -project $&#123;SPACE&#125; -scheme $&#123;SCHEME&#125; -archivePath $ARCHIVEPATH</span><br><span class="line">echo -e &quot;============Build Archive Success============&quot;</span><br><span class="line"></span><br><span class="line">echo -e &quot;============Export IPA============&quot;</span><br><span class="line">## 导出IPA包</span><br><span class="line">xcodebuild -exportArchive -archivePath $ARCHIVEPATH -exportPath $&#123;EXPORTPATH&#125; -exportOptionsPlist $&#123;EXPORTOPTIONSPLIST&#125;</span><br><span class="line">echo -e &quot;============Export IPA SUCCESS============&quot;</span><br><span class="line"></span><br><span class="line">## 编译完成时间 20181030_0931</span><br><span class="line">BUILD_DATE=&quot;$(date +&apos;%Y%m%d_%H%M&apos;)&quot;</span><br><span class="line"></span><br><span class="line">## info.plist路径</span><br><span class="line">PROJECT_INFOPLIST_PATH=&quot;$&#123;SORCEPATH&#125;/$&#123;TARGET_NAME&#125;/Info.plist&quot;</span><br><span class="line">## 取版本号</span><br><span class="line">BUNDLESHORTVERSION=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleShortVersionString&quot; &quot;$&#123;PROJECT_INFOPLIST_PATH&#125;&quot;)</span><br><span class="line">## 取build值</span><br><span class="line">VERSION=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleVersion&quot; &quot;$&#123;PROJECT_INFOPLIST_PATH&#125;&quot;)</span><br><span class="line">## ipa更名规则  项目名V版本_年月日_时分</span><br><span class="line">IPANAME=&quot;$&#123;TARGET_NAME&#125;V$&#123;BUNDLESHORTVERSION&#125;_$&#123;BUILD_DATE&#125;.ipa&quot;</span><br><span class="line">## 更名后ipa路径</span><br><span class="line">EXPORTPATHNEWIPA=$EXPORTPATH/$IPANAME</span><br><span class="line"></span><br><span class="line">echo -e &quot;============Export end :$&#123;BUILD_DATE&#125;============&quot;</span><br><span class="line">echo -e &quot;============IPA Old Name: $&#123;EXPORTPATHIPA&#125;============&quot;</span><br><span class="line">echo -e &quot;============IPA New Name: $&#123;EXPORTPATHNEWIPA&#125;============&quot;</span><br><span class="line"></span><br><span class="line">## IPA更名</span><br><span class="line">cp $EXPORTPATHIPA $EXPORTPATHNEWIPA</span><br><span class="line">echo -e &quot;============Create New Name Success============&quot;</span><br><span class="line">## 删除老IPA</span><br><span class="line">rm $EXPORTPATHIPA</span><br><span class="line">echo -e &quot;============Delete Old Name Success============&quot;</span><br></pre></td></tr></table></figure>
<h3 id="使用xcode插件构建"><a href="#使用xcode插件构建" class="headerlink" title="使用xcode插件构建"></a>使用xcode插件构建</h3><h4 id="General-build-settings（常规配置）"><a href="#General-build-settings（常规配置）" class="headerlink" title="General build settings（常规配置）"></a>General build settings（常规配置）</h4><p>常规的配置见下图所示，其他选项保持默认即可。<br><img src="http://pic.cloverkim.com/20200117175423.png" alt=""><br><img src="http://pic.cloverkim.com/20200117180315.png" alt=""></p>
<h4 id="Code-signing-amp-OS-X-keychain-options（keychain和签名证书管理）"><a href="#Code-signing-amp-OS-X-keychain-options（keychain和签名证书管理）" class="headerlink" title="Code signing &amp; OS X keychain options（keychain和签名证书管理）"></a>Code signing &amp; OS X keychain options（keychain和签名证书管理）</h4><p><img src="http://pic.cloverkim.com/20200117181507.png" alt=""></p>
<h4 id="Advanced-Xcode-build-options（构建高级选项）"><a href="#Advanced-Xcode-build-options（构建高级选项）" class="headerlink" title="Advanced Xcode build options（构建高级选项）"></a>Advanced Xcode build options（构建高级选项）</h4><p>&emsp;&emsp;构建的高级选项，主要设置支持cocoaPods的项目，需要配置workspace和项目目录以及项目文件，示例如下图所示：<br><img src="http://pic.cloverkim.com/20200117111050.png" alt="" title="构建高级选项"></p>
<h4 id="Versioning（构建版本管理）"><a href="#Versioning（构建版本管理）" class="headerlink" title="Versioning（构建版本管理）"></a>Versioning（构建版本管理）</h4><p>&emsp;&emsp;这里的版本控制，主要是为了在打包构建的时候，能手动输入版本号进行控制，从而更好的输出不同版本号的包进行测试，如下图所示，其中VERSION_NAME和BUILD_VERSION是在General中配置的多参数打包的String 参数，名称要一一对应。<br><img src="http://pic.cloverkim.com/20200117110536.png" alt="" title="版本控制"></p>
<h2 id="构建后的操作"><a href="#构建后的操作" class="headerlink" title="构建后的操作"></a>构建后的操作</h2><ul>
<li><p>输出构建完成信息 - Archive artifacts<br>&emsp;&emsp;增加一个构建后的操作步骤：Archive artifacts，<code>build/${BUILD_TYPE}-iphoneos/*.ipa</code>，这里用到的目录需要跟“General build settings”步骤中的Output directory输出目录进行对应，不然会匹配不到相对应的内容，如果需要输出所有构建结果，不用后面的通配符即可。如下图所示，虽然有报错，但是根据错误内容，是没任何问题的，保存即可。<br><img src="http://pic.cloverkim.com/20200117112049.png" alt="" title="Archive artifacts"></p>
</li>
<li><p>上传到fir.im/蒲公英</p>
<ul>
<li><p>fir.im，项目的配置如下图所示：<br><img src="http://pic.cloverkim.com/20200117114521.png" alt="" title="fir.im配置"></p>
</li>
<li><p>蒲公英：因为公司用到的是fir.im，所以暂时没有蒲公英的账号以及配置过程，详细的可以参考蒲公英官网的配置文档：<a href="https://www.pgyer.com/doc/view/jenkins_plugin" target="_blank" rel="noopener">使用 Jenkins 插件上传应用到蒲公英</a></p>
</li>
</ul>
</li>
<li><p>钉钉消息通知<br>&emsp;&emsp;配置钉钉消息通知，这里需要安装<code>Dingding[钉钉] Plugin</code>和<code>Dingding JSON Pusher Plugin</code>插件。示例如下图所示：<br><img src="http://pic.cloverkim.com/20200117113608.png" alt="" title="钉钉消息通知"><br>&emsp;&emsp;关于钉钉access token的字段，这里分享<a href="https://ding-doc.dingtalk.com/doc#/serverapi2/qf2nxq" target="_blank" rel="noopener">如何创建一个钉钉机器人</a>，添加完成后，将Webhook链接里的额access_token复制到Jenkins里即可。</p>
</li>
</ul>
<h1 id="用户权限管理"><a href="#用户权限管理" class="headerlink" title="用户权限管理"></a>用户权限管理</h1><p>&emsp;&emsp;Jenkins默认的权限管理并没有用户组的概念，但在实际工作中经常需要针对不同的用户组赋予不同的权限，通常需要第三方插件（<code>Role-based Authorization Strategy</code>）的支持来解决这个问题。</p>
<h2 id="设置授权策略"><a href="#设置授权策略" class="headerlink" title="设置授权策略"></a>设置授权策略</h2><p>&emsp;&emsp;安装完<code>Role-based Authorization Strategy</code>插件之后，进入<code>系统管理 - Configure Global Security</code>，授权策略会多出一个<code>Role-Based Strategy</code>选项，选择此项，其他设置如下图所示：<br><img src="http://pic.cloverkim.com/20200117193736.png" alt="" title="Configure Global Security"></p>
<h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><p>&emsp;&esmp;从<code>系统管理 - 管理用户 - 新建用户</code>中，创建用户，这里新建3个测试用户：<br><img src="http://pic.cloverkim.com/20200117194347.png" alt="" title="新建用户"></p>
<h2 id="管理和分配角色"><a href="#管理和分配角色" class="headerlink" title="管理和分配角色"></a>管理和分配角色</h2><p>&emsp;&emsp;当启用了角色授权策略后，默认只有admin用户拥有系统配置和项目的所有权限，其他用户需要添加角色和权限才可以，不然会没有任何权限。从<code>系统管理 - Manage and Assign Roles</code>进入管理和分配角色页面。</p>
<h3 id="Manager-Roles-管理角色"><a href="#Manager-Roles-管理角色" class="headerlink" title="Manager Roles 管理角色"></a>Manager Roles 管理角色</h3><p>&emsp;&emsp;对角色进行增加删除、权限设置，这里可以创建全局角色和项目角色，并分配不同的权限。</p>
<h4 id="全局角色、项目角色"><a href="#全局角色、项目角色" class="headerlink" title="全局角色、项目角色"></a>全局角色、项目角色</h4><ul>
<li><p>全局角色：默认情况下，全局角色中只有一个admin角色，拥有所有权限。通过<code>Role to add</code>添加自定义的全局角色，并通过矩阵选择的方式添加权限。这里添加两个全局角色，如下图所示，其中，global_test角色拥有读取Jenkins配置的权限、项目的增删改查等所有权限。others角色只有读取Jenkins配置的权限。<br><img src="http://pic.cloverkim.com/20200117195942.png" alt="" title="新增全局角色"></p>
</li>
<li><p>项目角色：配置项目角色的步骤跟全局角色类似，但是要设置pattern，用于匹配指定类型的项目，支持正则表达式。在这里，创建了如图所示的两个项目角色。<br>其中，web角色使用<code>web.*</code>匹配以web开头的项目，sample角色使用<code>sample.*</code>匹配以sample开头的项目。<br><img src="http://pic.cloverkim.com/20200117200215.png" alt="" title="新增项目角色"></p>
</li>
</ul>
<h4 id="两者的区别"><a href="#两者的区别" class="headerlink" title="两者的区别"></a>两者的区别</h4><ul>
<li>两者都需要通过<code>Role to add</code>添加角色。</li>
<li>两者的角色都是通过勾选对应的全选矩阵来设置不同的角色权限。</li>
<li>全局角色既可以设置管理Jenkins的配置，也可以设置管理项目，项目角色只能设置管理项目，没有管理Jenkins的权限配置。</li>
<li>添加项目角色时，要通过pattern设置角色可以匹配的项目名称，pattern支持正则表达式。<ul>
<li>如<code>Roger-.*</code>表示所有以<code>Roger-</code>开头的项目，区分大小写。</li>
<li><code>(?i)roger-.*</code>表示以<code>roger-</code>开头的项目，不区分大小写。</li>
<li><code>ABC|ABC.*</code>表示<code>ABC</code>或者以<code>ABC</code>开头的项目。</li>
<li><code>abc|bcd|efg</code>表示直接匹配多个项目。</li>
</ul>
</li>
</ul>
<h4 id="各种权限说明"><a href="#各种权限说明" class="headerlink" title="各种权限说明"></a>各种权限说明</h4><p>&emsp;&emsp;权限说明如下表所示，这里对部分不常用的权限进行了缩减。</p>
<table>
<thead>
<tr>
<th style="text-align:center">Overall</th>
<th style="text-align:center"></th>
<th style="text-align:center">Credentials（凭据）</th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center">Job（任务）</th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center">View（视图）</th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Administer</td>
<td style="text-align:center">Read</td>
<td style="text-align:center">Create</td>
<td style="text-align:center">Delete</td>
<td style="text-align:center">ManageDomains</td>
<td style="text-align:center">Update</td>
<td style="text-align:center">View</td>
<td style="text-align:center">Build</td>
<td style="text-align:center">Cancel</td>
<td style="text-align:center">Configure</td>
<td style="text-align:center">Create</td>
<td style="text-align:center">Delete</td>
<td style="text-align:center">Discover</td>
<td style="text-align:center">Move</td>
<td style="text-align:center">Read</td>
<td style="text-align:center">Workspace</td>
<td style="text-align:center">Configure</td>
<td style="text-align:center">Create</td>
<td style="text-align:center">Delete</td>
<td style="text-align:center">Read</td>
</tr>
<tr>
<td style="text-align:center">管理员</td>
<td style="text-align:center">可读</td>
<td style="text-align:center">新增</td>
<td style="text-align:center">删除</td>
<td style="text-align:center">管理域</td>
<td style="text-align:center">更新</td>
<td style="text-align:center">查看</td>
<td style="text-align:center">构建</td>
<td style="text-align:center">取消</td>
<td style="text-align:center">配置</td>
<td style="text-align:center">创建</td>
<td style="text-align:center">删除</td>
<td style="text-align:center">重定向</td>
<td style="text-align:center">移动</td>
<td style="text-align:center">可读</td>
<td style="text-align:center">查看工作区</td>
<td style="text-align:center">配置</td>
<td style="text-align:center">创建</td>
<td style="text-align:center">删除</td>
<td style="text-align:center">可读</td>
</tr>
</tbody>
</table>
<p>&emsp;&emsp;其中有一些比较特别的权限：</p>
<ul>
<li>最大的权限是Overall的Administer，拥有该权限可以对Jenkins进行任何操作。</li>
<li>最基本的权限是Overall的Read，用户必须赋予可读的权限。</li>
<li>给用户赋予权限时，Overall的Read和Job的Read权限要同时选中，不然该用户无权限访问该Job。</li>
<li>其他都是一些基本的权限，根据实际情况进行选择。</li>
</ul>
<h3 id="Assign-Roles-分配角色（对已经创建的角色分配具体的用户）"><a href="#Assign-Roles-分配角色（对已经创建的角色分配具体的用户）" class="headerlink" title="Assign Roles 分配角色（对已经创建的角色分配具体的用户）"></a>Assign Roles 分配角色（对已经创建的角色分配具体的用户）</h3><p>&emsp;&emsp;回到<code>Manage and Assign Roles</code>，进入<code>Assign roles</code>，在这里给全局角色和项目角色分配用户。如下图所示：这里分别对test1用户设置了admin的全局角色权限，对test2用户设置了global_test的全局角色权限，对test3用户设置了sample的项目角色权限。现在角色和用户已经配置完毕，可以使用不同的用户进行登录，查看不同的设置结果。<br>&emsp;&emsp;这里需要特别注意的地方，添加用户的时候，必须是之前已经创建好的用户。<br><img src="http://pic.cloverkim.com/20200117203108.png" alt="" title="分配全局角色"><br><img src="http://pic.cloverkim.com/20200117203128.png" alt="" title="分配项目角色"></p>
<h1 id="完整的持续集成流程"><a href="#完整的持续集成流程" class="headerlink" title="完整的持续集成流程"></a>完整的持续集成流程</h1><p>&emsp;&emsp;经过上面的持续集成，完整持续集成的流程如下图所示：<br><img src="http://pic.cloverkim.com/20200117203554.png" alt="" title="完整持续集成"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://www.jianshu.com/p/41ecb06ae95f/" target="_blank" rel="noopener">简书 - 一缕殇流化隐半边冰霜 - 手把手教你利用Jenkins持续集成iOS项目</a></li>
<li><a href="https://juejin.im/post/5dde3ecde51d45771465b5aa?utm_source=gold_browser_extension" target="_blank" rel="noopener">掘金 - 72行代码 - iOS 使用Jenkins持续集成(简称CI)</a></li>
<li><a href="https://blog.csdn.net/lijing742180/article/details/86552396" target="_blank" rel="noopener">CSDN - 媛测 - jenkins 用户权限管理</a></li>
</ul>

      
    </div>
    
    
    

    <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/ios-jenkins.html">iOS 使用Jenkins持续集成</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 kim逸云 的个人博客">kim逸云</a></p>
  <p><span>发布时间:</span>2022年10月26日 - 19:10</p>
  <p><span>最后更新:</span>2022年10月26日 - 19:10</p>
  <p><span>原始链接:</span><a href="/ios-jenkins.html" title="iOS 使用Jenkins持续集成">http://cloverkim.com/ios-jenkins.html</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://cloverkim.com/ios-jenkins.html"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
	});
    });  
</script>


      
    </div>

    <div>
      
        <div>
    <br>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">------本文结束<i class="fa fa-paw"></i>感谢阅读------</div>
    
</div>

      
    </div>

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/实践/" rel="tag"><i class="fa fa-tag"></i> 实践</a>
          
            <a href="/tags/持续集成/" rel="tag"><i class="fa fa-tag"></i> 持续集成</a>
          
            <a href="/tags/Jenkins/" rel="tag"><i class="fa fa-tag"></i> Jenkins</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/ios_faceid-touchid.html" rel="next" title="iOS开发 - Face ID & Touch ID">
                <i class="fa fa-chevron-left"></i> iOS开发 - Face ID & Touch ID
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/install_cocoapods.html" rel="prev" title="CocoaPods安装教程">
                CocoaPods安装教程 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/avatar.png"
                alt="kim逸云" />
            
              <p class="site-author-name" itemprop="name">kim逸云</p>
              <p class="site-description motion-element" itemprop="description">笑而不语是一种豁达，痛而不言是一种修养。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/CloverKim" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:jiang.shunjin@icloud.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Jenkins-概述"><span class="nav-number">1.</span> <span class="nav-text">Jenkins 概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Jenkins是什么？"><span class="nav-number">1.1.</span> <span class="nav-text">Jenkins是什么？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优点"><span class="nav-number">1.2.</span> <span class="nav-text">优点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Jenkins-安装"><span class="nav-number">2.</span> <span class="nav-text">Jenkins 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#pkg镜像安装"><span class="nav-number">2.1.</span> <span class="nav-text">pkg镜像安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Homebrew"><span class="nav-number">2.2.</span> <span class="nav-text">Homebrew</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#war包方式安装（推荐）"><span class="nav-number">2.3.</span> <span class="nav-text">war包方式安装（推荐）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Jenkins配置"><span class="nav-number">3.</span> <span class="nav-text">Jenkins配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#初始化"><span class="nav-number">3.1.</span> <span class="nav-text">初始化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#插件安装"><span class="nav-number">3.2.</span> <span class="nav-text">插件安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常用插件介绍"><span class="nav-number">3.2.1.</span> <span class="nav-text">常用插件介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装"><span class="nav-number">3.2.2.</span> <span class="nav-text">安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#keychain和证书上传配置"><span class="nav-number">3.3.</span> <span class="nav-text">keychain和证书上传配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建项目、配置"><span class="nav-number">4.</span> <span class="nav-text">创建项目、配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建"><span class="nav-number">4.1.</span> <span class="nav-text">创建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#General配置"><span class="nav-number">4.2.</span> <span class="nav-text">General配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#源代码管理"><span class="nav-number">4.3.</span> <span class="nav-text">源代码管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#构建触发器"><span class="nav-number">4.4.</span> <span class="nav-text">构建触发器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#构建环境"><span class="nav-number">4.5.</span> <span class="nav-text">构建环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#构建步骤"><span class="nav-number">4.6.</span> <span class="nav-text">构建步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用脚本构建"><span class="nav-number">4.6.1.</span> <span class="nav-text">使用脚本构建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#自动化打包命令xcodebuild-xcrun介绍"><span class="nav-number">4.6.1.1.</span> <span class="nav-text">自动化打包命令xcodebuild + xcrun介绍</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用xcode插件构建"><span class="nav-number">4.6.2.</span> <span class="nav-text">使用xcode插件构建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#General-build-settings（常规配置）"><span class="nav-number">4.6.2.1.</span> <span class="nav-text">General build settings（常规配置）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Code-signing-amp-OS-X-keychain-options（keychain和签名证书管理）"><span class="nav-number">4.6.2.2.</span> <span class="nav-text">Code signing &amp; OS X keychain options（keychain和签名证书管理）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Advanced-Xcode-build-options（构建高级选项）"><span class="nav-number">4.6.2.3.</span> <span class="nav-text">Advanced Xcode build options（构建高级选项）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Versioning（构建版本管理）"><span class="nav-number">4.6.2.4.</span> <span class="nav-text">Versioning（构建版本管理）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#构建后的操作"><span class="nav-number">4.7.</span> <span class="nav-text">构建后的操作</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#用户权限管理"><span class="nav-number">5.</span> <span class="nav-text">用户权限管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#设置授权策略"><span class="nav-number">5.1.</span> <span class="nav-text">设置授权策略</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建用户"><span class="nav-number">5.2.</span> <span class="nav-text">创建用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#管理和分配角色"><span class="nav-number">5.3.</span> <span class="nav-text">管理和分配角色</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Manager-Roles-管理角色"><span class="nav-number">5.3.1.</span> <span class="nav-text">Manager Roles 管理角色</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#全局角色、项目角色"><span class="nav-number">5.3.1.1.</span> <span class="nav-text">全局角色、项目角色</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#两者的区别"><span class="nav-number">5.3.1.2.</span> <span class="nav-text">两者的区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#各种权限说明"><span class="nav-number">5.3.1.3.</span> <span class="nav-text">各种权限说明</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Assign-Roles-分配角色（对已经创建的角色分配具体的用户）"><span class="nav-number">5.3.2.</span> <span class="nav-text">Assign Roles 分配角色（对已经创建的角色分配具体的用户）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#完整的持续集成流程"><span class="nav-number">6.</span> <span class="nav-text">完整的持续集成流程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考"><span class="nav-number">7.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart" aria-hidden="true"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kim逸云</span>

<!--
  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">77.8k</span>
  
-->
</div>

<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数：<span id="busuanzi_value_site_uv"></span>
</span>


  <span class="post-meta-divider">|</span>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共77.8k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.init("G2qCMJW5Y7Vdp7p7AjogwjJp-gzGzoHsz", "khenv4NT1LkNeUV3t853rJJU");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

  <!-- 背景动画 -->
  <script type="text/javascript" src="/js/src/particle.js"></script>
  <!-- 页面点击小红心 -->
  <script type="text/javascript" src="/js/src/love.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":100,"height":200},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
